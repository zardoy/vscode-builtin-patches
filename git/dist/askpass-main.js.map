{"version":3,"sources":["webpack://git/./src/ipc/ipcClient.ts","webpack://git/external \"fs\"","webpack://git/external \"http\"","webpack://git/webpack/bootstrap","webpack://git/./src/askpass-main.ts"],"names":["constructor","handlerName","ipcHandlePath","process","env","Error","this","call","request","opts","socketPath","path","method","Promise","c","e","req","http","res","statusCode","chunks","on","d","push","JSON","parse","Buffer","concat","toString","err","write","stringify","end","module","exports","require","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","fatal","console","error","exit","argv","output","askpassType","host","file","fingerprint","replace","test","IPCClient","then","fs","writeFileSync","setTimeout","catch","main"],"mappings":"6GAKA,gBAEA,kBAICA,YAAoBC,GAAA,KAAAA,cACnB,MAAMC,EAAgBC,QAAQC,IAA2B,sBAEzD,IAAKF,EACJ,MAAM,IAAIG,MAAM,iCAGjBC,KAAKJ,cAAgBA,EAGtBK,KAAKC,GACJ,MAAMC,EAA4B,CACjCC,WAAYJ,KAAKJ,cACjBS,KAAM,IAAIL,KAAKL,cACfW,OAAQ,QAGT,OAAO,IAAIC,SAAQ,CAACC,EAAGC,KACtB,MAAMC,EAAMC,EAAKT,QAAQC,GAAMS,IAC9B,GAAuB,MAAnBA,EAAIC,WACP,OAAOJ,EAAE,IAAIV,MAAM,oBAAoBa,EAAIC,eAG5C,MAAMC,EAAmB,GACzBF,EAAIG,GAAG,QAAQC,GAAKF,EAAOG,KAAKD,KAChCJ,EAAIG,GAAG,OAAO,IAAMP,EAAEU,KAAKC,MAAMC,OAAOC,OAAOP,GAAQQ,SAAS,eAGjEZ,EAAIK,GAAG,SAASQ,GAAOd,EAAEc,KACzBb,EAAIc,MAAMN,KAAKO,UAAUvB,IACzBQ,EAAIgB,Y,SCzCPC,EAAOC,QAAUC,QAAQ,O,SCAzBF,EAAOC,QAAUC,QAAQ,UCCrBC,EAA2B,GAG/B,SAASC,EAAoBC,GAE5B,IAAIC,EAAeH,EAAyBE,GAC5C,QAAqBE,IAAjBD,EACH,OAAOA,EAAaL,QAGrB,IAAID,EAASG,EAAyBE,GAAY,CAGjDJ,QAAS,IAOV,OAHAO,EAAoBH,GAAUL,EAAQA,EAAOC,QAASG,GAG/CJ,EAAOC,Q,wEChBf,gBACA,UAEA,SAASQ,EAAMb,GACdc,QAAQC,MAAM,mCACdD,QAAQC,MAAMf,GACd1B,QAAQ0C,KAAK,IAGd,SAAcC,GACb,IAAK3C,QAAQC,IAA6B,wBACzC,OAAOsC,EAAM,gBAGd,IAAKvC,QAAQC,IAA6B,wBACzC,OAAOsC,EAAM,gBAGd,GAA+C,UAA3CvC,QAAQC,IAA6B,yBAA4D,QAA3CD,QAAQC,IAA6B,wBAC9F,OAAOsC,EAAM,iBAAiBvC,QAAQC,IAA6B,2BAGpE,GAA0C,UAAtCD,QAAQC,IAAwB,oBAAmBD,QAAQC,IAA6B,wBAC3F,OAAOsC,EAAM,8BAGd,MAAMK,EAAS5C,QAAQC,IAA6B,wBAC9C4C,EAAc7C,QAAQC,IAA6B,wBAGnDI,EAA0B,UAAhBwC,EAA0BF,EAAK,GAAKA,EAAK,GAEzD,IAAIG,EACHC,EACAC,EAEmB,UAAhBH,IACHC,EAAOH,EAAK,GAAGM,QAAQ,kBAAmB,KAGvB,QAAhBJ,IACC,cAAcK,KAAK7C,GAEtB0C,EAAOJ,EAAK,GAAGM,QAAQ,kBAAmB,KAG1CH,EAAOH,EAAK,GAAGM,QAAQ,kBAAmB,IAC1CD,EAAcL,EAAK,MAIH,IAAI,EAAAQ,UAAU,WACtB/C,KAAK,CAAEyC,cAAaxC,UAASyC,OAAMC,OAAMC,gBAAeI,MAAKrC,IACtEsC,EAAGC,cAAcV,EAAQ7B,EAAM,MAC/BwC,YAAW,IAAMvD,QAAQ0C,KAAK,IAAI,MAChCc,OAAM9B,GAAOa,EAAMb,KAGvB+B,CAAKzD,QAAQ2C,O","file":"askpass-main.js","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\n\r\nimport * as http from 'http';\r\n\r\nexport class IPCClient {\r\n\r\n\tprivate ipcHandlePath: string;\r\n\r\n\tconstructor(private handlerName: string) {\r\n\t\tconst ipcHandlePath = process.env['VSCODE_GIT_IPC_HANDLE'];\r\n\r\n\t\tif (!ipcHandlePath) {\r\n\t\t\tthrow new Error('Missing VSCODE_GIT_IPC_HANDLE');\r\n\t\t}\r\n\r\n\t\tthis.ipcHandlePath = ipcHandlePath;\r\n\t}\r\n\r\n\tcall(request: any): Promise<any> {\r\n\t\tconst opts: http.RequestOptions = {\r\n\t\t\tsocketPath: this.ipcHandlePath,\r\n\t\t\tpath: `/${this.handlerName}`,\r\n\t\t\tmethod: 'POST'\r\n\t\t};\r\n\r\n\t\treturn new Promise((c, e) => {\r\n\t\t\tconst req = http.request(opts, res => {\r\n\t\t\t\tif (res.statusCode !== 200) {\r\n\t\t\t\t\treturn e(new Error(`Bad status code: ${res.statusCode}`));\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst chunks: Buffer[] = [];\r\n\t\t\t\tres.on('data', d => chunks.push(d));\r\n\t\t\t\tres.on('end', () => c(JSON.parse(Buffer.concat(chunks).toString('utf8'))));\r\n\t\t\t});\r\n\r\n\t\t\treq.on('error', err => e(err));\r\n\t\t\treq.write(JSON.stringify(request));\r\n\t\t\treq.end();\r\n\t\t});\r\n\t}\r\n}\r\n","module.exports = require(\"fs\");","module.exports = require(\"http\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\n\r\nimport * as fs from 'fs';\r\nimport { IPCClient } from './ipc/ipcClient';\r\n\r\nfunction fatal(err: any): void {\r\n\tconsole.error('Missing or invalid credentials.');\r\n\tconsole.error(err);\r\n\tprocess.exit(1);\r\n}\r\n\r\nfunction main(argv: string[]): void {\r\n\tif (!process.env['VSCODE_GIT_ASKPASS_PIPE']) {\r\n\t\treturn fatal('Missing pipe');\r\n\t}\r\n\r\n\tif (!process.env['VSCODE_GIT_ASKPASS_TYPE']) {\r\n\t\treturn fatal('Missing type');\r\n\t}\r\n\r\n\tif (process.env['VSCODE_GIT_ASKPASS_TYPE'] !== 'https' && process.env['VSCODE_GIT_ASKPASS_TYPE'] !== 'ssh') {\r\n\t\treturn fatal(`Invalid type: ${process.env['VSCODE_GIT_ASKPASS_TYPE']}`);\r\n\t}\r\n\r\n\tif (process.env['VSCODE_GIT_COMMAND'] === 'fetch' && !!process.env['VSCODE_GIT_FETCH_SILENT']) {\r\n\t\treturn fatal('Skip silent fetch commands');\r\n\t}\r\n\r\n\tconst output = process.env['VSCODE_GIT_ASKPASS_PIPE'] as string;\r\n\tconst askpassType = process.env['VSCODE_GIT_ASKPASS_TYPE'] as 'https' | 'ssh';\r\n\r\n\t// HTTPS (username | password), SSH (passphrase | authenticity)\r\n\tconst request = askpassType === 'https' ? argv[2] : argv[3];\r\n\r\n\tlet host: string | undefined,\r\n\t\tfile: string | undefined,\r\n\t\tfingerprint: string | undefined;\r\n\r\n\tif (askpassType === 'https') {\r\n\t\thost = argv[4].replace(/^[\"']+|[\"':]+$/g, '');\r\n\t}\r\n\r\n\tif (askpassType === 'ssh') {\r\n\t\tif (/passphrase/i.test(request)) {\r\n\t\t\t// passphrase\r\n\t\t\tfile = argv[6].replace(/^[\"']+|[\"':]+$/g, '');\r\n\t\t} else {\r\n\t\t\t// authenticity\r\n\t\t\thost = argv[6].replace(/^[\"']+|[\"':]+$/g, '');\r\n\t\t\tfingerprint = argv[15];\r\n\t\t}\r\n\t}\r\n\r\n\tconst ipcClient = new IPCClient('askpass');\r\n\tipcClient.call({ askpassType, request, host, file, fingerprint }).then(res => {\r\n\t\tfs.writeFileSync(output, res + '\\n');\r\n\t\tsetTimeout(() => process.exit(0), 0);\r\n\t}).catch(err => fatal(err));\r\n}\r\n\r\nmain(process.argv);\r\n"],"sourceRoot":""}